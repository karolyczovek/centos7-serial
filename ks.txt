#version=DEVEL

# System authorization information
auth --useshadow  --passalgo=sha512

# Install OS instead of upgrade
install

# Install from URI
url --url="http://mirror.zetup.net/CentOS/7/os/x86_64/"

# Reboot after install
reboot

# Network configuration
network  --bootproto=dhcp --device=eth0 --ipv6=auto --activate


# Console and i8s
keyboard --vckeymap=us --xlayouts='us'
lang en_US.UTF-8

# Root PW
rootpw --plaintext changeme


services --enabled="chronyd sshd"
timezone Europe/Budapest --isUtc

logging --level=debug


clearpart --drives=sda,sdb
zerombr

bootloader --location=mbr --driveorder=sda,sdb
bootloader --append="crashkernel=auto" --location=mbr --boot-drive=sda

part  --asprimary --fstype="raid" --onpart=sda1 --size=1024
part  --asprimary --fstype="raid" --grow --onpart=sda2 --size=1
part  --asprimary --fstype="raid" --onpart=sdb1 --size=1024
part  --asprimary --fstype="raid" --grow --onpart=sdb2 --size=1

raid /boot --device=0 --fstype="ext3" --level=RAID1 raid.01 raid.02
raid  --device=1 --fstype="physical volume (LVM)" --level=RAID1 raid.03 raid.04

volgroup fedora --pesize=32768 pv.01
logvol /  --fstype="ext4" --size=20000 --name=root --vgname=fedora
logvol /home  --fstype="ext4" --size=15000 --name=home --vgname=fedora
logvol swap   --fstype="swap" --size=8000 --name=swap --vgname=fedora

repo --name="EPEL" --baseurl=http://dl.fedoraproject.org/pub/epel/7/x86_64/

%pre --interpreter=/usr/bin/python
cmdline = ''
with open('/proc/cmdline', 'r') as myfile:
  cmdline = myfile.read()
pieces = cmdline.split(' ')
for piece in pieces:
  if 'ks=' in piece:
    KS_LOCATION = piece[ piece.rfind('ks=')+3 : piece.rfind('/') ]
%end


%packages
@compat-libraries
@core
wget
net-tools
chrony
openssh-server
openssh-clients
%end


